CREATE
OR REPLACE VIEW "dev"."base".fbf_full_email_list AS WITH latest_partition AS (
    SELECT
        year,
        month
    FROM
        "dev"."raw".full_email_list
    ORDER BY
        year DESC,
        month DESC
    LIMIT
        1
)
SELECT
    NULLIF(
        TRIM(
            BOTH '"'
            FROM
                email_address
        ),
        ''
    ) as email_address,
    is_email_personal,
    NULLIF(
        TRIM(
            BOTH '"'
            FROM
                sha256_lc_hem
        ),
        ''
    ) as sha256,
    a.year || '-' || a.month as dataset_version
FROM
    "dev"."raw".full_email_list a,
    latest_partition b
WHERE
    a.year = b.year
    AND a.month = b.month WITH NO SCHEMA BINDING;